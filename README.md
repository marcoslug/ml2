
# ML<sup>2</sup>: Machine Learning based Movie Labeler

## In a few words...

ML<sup>2</sup> is a simple machine learning algorithm that predicts the genre of a movie 
given its title and  description.
It is written in Python (tested with Python 3.7.5) and uses functions 
from the popular machine learning library _Scikit-learn_ (version 0.21.3).

There are two scripts that serve as entry points:
- _train_model.py_: script that trains a model from an input CSV file 
and generates an associated Python serialized object;
- _movie_classifier.py_: script that allows to predict the genre of an input movie,
by using the file generated by the former script.

Source code is instead in the _ml2_ sub-directory.
A version of the model is already included in the repository, saved as _resources/ml2_model.joblib_.
The classification script can therefore be immediately launched, without the need of retraining.

## Data used

The data used to train the ML<sup>2</sup> model is a Kaggle data set 
that can be downloaded at the following URL:
https://www.kaggle.com/PromptCloudHQ/imdb-data/data .

The downloadable file a zip archive containing a CSV file named _IMDB-Movie-Data.csv_.
The data set consists of 1000 popular movies on IMDB from 2006 to 2016. 
Each movie can be associated to multiple genres. To have a unique label for each sample,
a prioritization order is established for the different genres. 
Moreover, a final genre mapping is performed to further reduce the number of labels.
  
The resulting taxonomy consists of 9 genres: 
Action, Adventure, Animation, Biography, Comedy, Drama, Horror, Sci-Fi, and Thriller.

## Model adopted

Given the relatively small size of the data set, a simple model is taken.

- A _CountVectorizer_ is applied on the concatenation of title and description to obtain 
the bag-of-words representation of the text of a movie.
- A Multinomial Logistic Regression (_MLR_) model is trained on the obtained vectors of word occurrences.

_CountVectorizer_ has been chosen as a text feature extractor, since the limited data set size does not
allow to extract more sophisticated features that could be meaningful.
 _MLR_ has been chosen, since it has been proven to be an efficient method for multi-class text classification,
 especially in combination with bags-of-words. Moreover, its functioning is very intuitive.  


## How to run the coee

#### Set-up

To run the code, it is suggested to create a virtual environment with Python 3.7. 
All required packages are specified in the _requirements.txt_ file. 
Once the virtual environment is created, the installation of the package can be done by running the 
following command.
```
pip install -r requirements.txt
```
#### Running the script to (re-)train the model

The file containing the model is already included in the project repository.
However, if one wants to retrain the model, it is nevertheless possible via the _train_model.py_ script.

First, the zip archive of the data set has to be downloaded from the URL of the Kaggle website specified above.
Let's suppose that the file is unzipped at the root of the project, 
where we will then have the file _IMDB-Movie-Data.csv_. 

The training script can then be run with the following command:
```
python train_model.py --file IMDB-Movie-Data.csv
```
This will train the model and save it in the _resources_ directory as _ml2_model.joblib_.

#### Running the script to make a new prediction

To make a movie genre prediction, it is sufficient to run the _movie_classifier.py_ script, 
with the title and the description of the input movie as arguments. Example of usage: 
```
python movie_classifier.py --title "Othello" --description "The evil Iago pretends to be friend of Othello in order to manipulate him to serve his own end in the film version of this Shakespeare classic."
```
This will print on screen the response as a JSON formatted string, with the predicted genre as an extra field.
If the model file is not found, an error message will appear and the genre field will be empty.

#### How to run the prediction script with Docker

An alternative to using a local Python environment is to run the code within a Docker container.
A _Dockerfile_ has been included to the repository that allows to launch the _movie_classifier.py_ script
with Docker.

In order to do that, first the related Docker image has to be built with the following command
(typed at the project root):
```
docker build -t ml2 .
```

A Docker container is then run by adding the _title_ and _description_ arguments 
used by the script.
```
docker run --rm ml2 --title "Othello" --description "The evil Iago pretends to be friend of Othello..."
```

## Automated tests

Unit tests have been written for most of the code of the source modules (_train.py_ and _predict.py_) 
\- excluding those parts consisting in the mere execution of standard library functions. 
The tests can be found in the _tests_ directory.

To run all tests, it is possible to type the following command from the project root:
```
python -m unittest discover
```
